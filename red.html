<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–¢—Ä–µ–Ω–∞–∂—ë—Ä ¬´–ß–∞—Å–∏–∫–∏¬ª</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f4f7fc;
      margin: 0;
      padding: 0;
      color: #2c3e50;
    }
    header {
      background: #ecf3fb;
      padding: 16px 20px;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .header-title {
      font-size: 1.6rem;
      font-weight: bold;
      margin-top: 8px;
    }
    .header-title span {
      font-size: 2rem;
    }
    .btn-back {
      display: inline-block;
      background: #3498db;
      color: #fff;
      padding: 10px 18px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .levels {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin: 10px 0 20px;
    }
    .levels button {
      background: #3498db;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }
    .levels button:hover {
      background: #2980b9;
    }
    .stats {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 0 auto 20px;
      max-width: 500px;
      flex-wrap: wrap;
    }
    .stat-box {
      flex: 1 1 120px;
      background: #f8fcff;
      border-radius: 12px;
      padding: 12px;
      text-align: center;
      box-shadow: 0 1px 4px rgba(0,0,0,0.05);
    }
    .stat-box p {
      font-size: 1rem;
      margin: 4px 0;
    }
    .clock {
      position: relative;
      width: 90vmin;
      height: 90vmin;
      max-width: 300px;
      max-height: 300px;
      margin: 30px auto;
      border: 6px solid #3498db;
      border-radius: 50%;
      background: radial-gradient(circle, #fff, #dfeeff);
    }
    .center-dot {
      width: 12px;
      height: 12px;
      background: #000;
      border-radius: 50%;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
    }
    .hand {
      position: absolute;
      bottom: 50%;
      left: 50%;
      transform-origin: bottom center;
      border-radius: 5px;
      cursor: grab;
      touch-action: none;
    }
    .hand.hour {
      width: 6px;
      height: 26%;
      background: red;
      z-index: 6;
    }
    .hand.minute {
      width: 4px;
      height: 38%;
      background: blue;
      z-index: 5;
    }
    .number {
      position: absolute;
      font-weight: bold;
      font-size: 1rem;
      transform: translate(-50%, -50%);
    }
    .info {
      text-align: center;
      font-size: 1.1rem;
      margin-bottom: 10px;
    }
    #result {
      font-size: 1.2rem;
      text-align: center;
      margin-top: 15px;
    }
  </style>
</head>
<body>

  <header>
    <a class="btn-back" href="index.html">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç–µ–æ—Ä–∏–∏</a>
    <div class="header-title">üïí –¢—Ä–µ–Ω–∞–∂—ë—Ä <span>¬´–ß–∞—Å–∏–∫–∏¬ª</span></div>
    <div class="levels">
      <button disabled>–£—Ä–æ–≤–µ–Ω—å 1</button>
      <button disabled>–£—Ä–æ–≤–µ–Ω—å 2</button>
      <button disabled>–£—Ä–æ–≤–µ–Ω—å 3</button>
    </div>
  </header>

  <div class="stats">
    <div class="stat-box">
      <p><strong>–ü—Ä–∞–≤–∏–ª—å–Ω–æ</strong></p>
      <p id="correct">0</p>
    </div>
    <div class="stat-box">
      <p><strong>–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ</strong></p>
      <p id="wrong">0</p>
    </div>
    <div class="stat-box">
      <p><strong>–ü—Ä–æ–≥—Ä–µ—Å—Å</strong></p>
      <p id="progress">0%</p>
    </div>
  </div>
  <div class="info">–£—Å—Ç–∞–Ω–æ–≤–∏ –Ω–∞ —Ü–∏—Ñ–µ—Ä–±–ª–∞—Ç–µ: <strong id="targetTime">--:--</strong></div>

  <div class="clock" id="clock">
    <div class="hand hour" id="hourHand"></div>
    <div class="hand minute" id="minuteHand"></div>
    <div class="center-dot"></div>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const positions = [
          [1, 215, 37],[2, 263, 85],[3, 280, 150],[4, 263, 215],
          [5, 215, 263],[6, 150, 280],[7, 85, 263],[8, 37, 215],
          [9, 20, 150],[10, 37, 85],[11, 85, 37],[12, 150, 20]
        ];
        const clock = document.getElementById("clock");
        positions.forEach(([num, x, y]) => {
          const el = document.createElement("div");
          el.className = "number";
          el.style.left = `${x / 300 * 100}%`;
          el.style.top = `${y / 300 * 100}%`;
          el.textContent = num;
          clock.appendChild(el);
        });
      });
    </script>
  </div>

  <div id="result"></div>
<script>
  const hourHand = document.getElementById("hourHand");
  const minuteHand = document.getElementById("minuteHand");
  const targetTimeDisplay = document.getElementById("targetTime");
  const result = document.getElementById("result");

  const correctEl = document.getElementById("correct");
  const wrongEl = document.getElementById("wrong");
  const progressEl = document.getElementById("progress");

  let dragging = null;
  let targetHour = 0;
  let targetMinute = 0;

  let currentHourAngle = 270;
  let currentMinuteAngle = 90;

  let correctCount = 0;
  let wrongCount = 0;

  const setRotation = (el, angle) => {
    el.style.transform = `rotate(${angle}deg)`;
  };

  const roundToQuarter = (angle) => {
    const quarters = [0, 90, 180, 270, 360];
    return quarters.reduce((prev, curr) =>
      Math.abs(curr - angle) < Math.abs(prev - angle) ? curr : prev
    );
  };

  const roundToHour = (angle) => Math.round(angle / 30) * 30;

  function generateTime() {
    const hours = Math.floor(Math.random() * 24);
    const minutes = [0, 15, 30, 45][Math.floor(Math.random() * 4)];
    targetHour = hours;
    targetMinute = minutes;
    targetTimeDisplay.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
    result.textContent = '';
    currentHourAngle = 270;
    currentMinuteAngle = 90;
    setRotation(hourHand, currentHourAngle);
    setRotation(minuteHand, currentMinuteAngle);
  }

  function updateStats() {
    correctEl.textContent = correctCount;
    wrongEl.textContent = wrongCount;
    const total = correctCount + wrongCount;
    const percent = total === 0 ? 0 : Math.round((correctCount / total) * 100);
    progressEl.textContent = `${percent}%`;
  }

  function checkAnswer() {
    const hour = Math.round((currentHourAngle % 360) / 30) % 12;
    const minute = Math.round((currentMinuteAngle % 360) / 6) % 60;
    const guessedHour = hour + (targetHour >= 12 ? 12 : 0);
    const guessedMinute = Math.round(minute / 15) * 15 % 60;

    if (guessedHour === targetHour && guessedMinute === targetMinute) {
      result.textContent = "‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!";
      result.style.color = "#27ae60";
      correctCount++;
      updateStats();
      setTimeout(generateTime, 1000);
    } else {
      result.textContent = `‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ë—ã–ª–æ: ${targetHour}:${targetMinute.toString().padStart(2, '0')}`;
      result.style.color = "#e74c3c";
      wrongCount++;
      updateStats();
    }
  }

  function setupDragging(hand, isHour) {
    const moveDrag = (clientX, clientY) => {
      const rect = document.getElementById("clock").getBoundingClientRect();
      const cx = rect.left + rect.width / 2;
      const cy = rect.top + rect.height / 2;
      const dx = clientX - cx;
      const dy = clientY - cy;
      let angle = Math.atan2(dx, -dy) * 180 / Math.PI;
      if (angle < 0) angle += 360;

      if (dragging?.isHour) {
        currentHourAngle = angle;
        setRotation(hourHand, angle);
      } else if (dragging?.isMinute) {
        currentMinuteAngle = angle;
        setRotation(minuteHand, angle);
      }
    };

    const animateTo = (el, fromAngle, toAngle, isHour) => {
      const duration = 200;
      const start = performance.now();

      const animate = (now) => {
        let progress = Math.min((now - start) / duration, 1);
        const current = fromAngle + (toAngle - fromAngle) * progress;
        setRotation(el, current);
        if (progress < 1) {
          requestAnimationFrame(animate);
        } else {
          if (isHour) currentHourAngle = toAngle;
          else currentMinuteAngle = toAngle;
          checkAnswer();
        }
      };
      requestAnimationFrame(animate);
    };

    const snapOnRelease = () => {
      if (dragging) {
        if (dragging.isHour) {
          const snapped = roundToHour(currentHourAngle);
          animateTo(hourHand, currentHourAngle, snapped, true);
        } else if (dragging.isMinute) {
          const snapped = roundToQuarter(currentMinuteAngle);
          animateTo(minuteHand, currentMinuteAngle, snapped, false);
        }
        dragging = null;
      }
    };

    hand.addEventListener("mousedown", e => {
      e.preventDefault();
      dragging = isHour ? { isHour: true } : { isMinute: true };
    });
    hand.addEventListener("touchstart", e => {
      dragging = isHour ? { isHour: true } : { isMinute: true };
    });

    document.addEventListener("mousemove", e => {
      if (dragging) moveDrag(e.clientX, e.clientY);
    });

    document.addEventListener("touchmove", e => {
      if (dragging) {
        const t = e.touches[0];
        moveDrag(t.clientX, t.clientY);
      }
    }, { passive: false });

    document.addEventListener("mouseup", snapOnRelease);
    document.addEventListener("touchend", snapOnRelease);
  }

  setupDragging(hourHand, true);
  setupDragging(minuteHand, false);
  generateTime();
</script>
</body>
</html>