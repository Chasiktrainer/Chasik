<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–¢—Ä–µ–Ω–∞–∂—ë—Ä ¬´–ß–∞—Å–∏–∫–∏¬ª</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f4f7fc;
      margin: 0;
      padding: 0;
      color: #2c3e50;
      text-align: center;
      overscroll-behavior: none;
    }
    a {
      display: inline-block;
      text-decoration: none;
      background: #3498db;
      color: #fff;
      padding: 10px 16px;
      border-radius: 8px;
      font-weight: bold;
      margin: 20px;
    }
    h1 {
      font-size: 2rem;
      margin: 10px 0;
    }
    .levels {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .levels button {
      background: #3498db;
      color: white;
      border: none;
      padding: 10px 16px;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
    }
    .stats {
      background: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      max-width: 400px;
      margin: 0 auto 30px;
    }
    .stats h3 {
      margin-bottom: 12px;
    }
    .stat-block {
      margin-bottom: 12px;
      font-size: 1.1rem;
    }

    /* CLOCK UI */
    .wrapper {
      max-width: 480px;
      margin: 0 auto 40px;
      padding: 0 16px;
    }
    .clock-box {
      border-radius: 20px;
      background: white;
      box-shadow: 0 4px 20px rgba(0,0,0,0.06);
      padding: 24px;
      position: relative;
      margin-bottom: 20px;
    }
    .clock-box::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      height: 8px;
      width: 100%;
      border-radius: 20px 20px 0 0;
      background: linear-gradient(to right, #e74c3c, #3498db);
    }
    .clock {
      position: relative;
      width: 250px;
      height: 250px;
      margin: 20px auto;
      border: 4px solid #3498db;
      border-radius: 50%;
      background: white;
    }
    .hand {
      position: absolute;
      bottom: 50%;
      left: 50%;
      transform-origin: bottom center;
      border-radius: 4px;
    }
    .hand.hour {
      width: 6px;
      height: 65px;
      background: red;
      z-index: 2;
    }
    .hand.minute {
      width: 4px;
      height: 90px;
      background: blue;
      z-index: 1;
    }
    .center-dot {
      width: 12px;
      height: 12px;
      background: black;
      border-radius: 50%;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 3;
    }
    .number {
      position: absolute;
      font-weight: bold;
      font-size: 1rem;
      transform: translate(-50%, -50%);
    }

    .panel {
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    .panel h2 {
      font-size: 1.2rem;
      margin-bottom: 8px;
    }
    .panel p {
      font-size: 1.1rem;
      margin-bottom: 16px;
    }
    .btns {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .btn {
      padding: 10px 18px;
      font-size: 1rem;
      font-weight: bold;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: 0.2s;
    }
    .check {
      background: #3498db;
      color: #fff;
    }
    .check:hover {
      background: #2980b9;
    }
    .new {
      background: #bdc3c7;
      color: #fff;
      cursor: not-allowed;
    }
    .success {
      background: #2ecc71;
      color: white;
      margin-top: 12px;
      padding: 10px;
      border-radius: 8px;
    }
    .error {
      background: #e74c3c;
      color: white;
      margin-top: 12px;
      padding: 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>

<a href="index.html">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ç–µ–æ—Ä–∏–∏</a>
<h1>–¢—Ä–µ–Ω–∞–∂—ë—Ä "–ß–∞—Å–∏–∫–∏"</h1>

<div class="levels">
  <button onclick="startLevel(1)">–£—Ä–æ–≤–µ–Ω—å 1</button>
  <button disabled>–£—Ä–æ–≤–µ–Ω—å 2</button>
  <button disabled>–£—Ä–æ–≤–µ–Ω—å 3</button>
</div>

<div class="stats">
  <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
  <div class="stat-block">–ü—Ä–∞–≤–∏–ª—å–Ω–æ: <span id="correct">0</span></div>
  <div class="stat-block">–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: <span id="wrong">0</span></div>
  <div class="stat-block">–ü—Ä–æ–≥—Ä–µ—Å—Å: <span id="progress">0%</span></div>
</div>

<div id="gameArea" class="wrapper" style="display: none;">
  <div class="clock-box">
    <div class="clock" id="clock">
      <div class="hand hour" id="hourHand"></div>
      <div class="hand minute" id="minuteHand"></div>
      <div class="center-dot"></div>
    </div>
  </div>

  <div class="panel">
    <h2>üïí –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Ä–µ–º—è</h2>
    <p>–ó–∞–¥–∞–Ω–æ –≤—Ä–µ–º—è: <strong id="targetTime">--:--</strong></p>

    <div class="btns">
      <button class="btn check" id="checkBtn">‚úî –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
      <button class="btn new" id="newBtn" disabled>‚Üª –ù–æ–≤–æ–µ –≤—Ä–µ–º—è</button>
    </div>

    <div id="feedback"></div>
  </div>
  <script>
  const hourHand = document.getElementById("hourHand");
  const minuteHand = document.getElementById("minuteHand");
  const checkBtn = document.getElementById("checkBtn");
  const newBtn = document.getElementById("newBtn");
  const feedback = document.getElementById("feedback");
  const targetDisplay = document.getElementById("targetTime");

  const correctEl = document.getElementById("correct");
  const wrongEl = document.getElementById("wrong");
  const progressEl = document.getElementById("progress");

  let dragging = null;
  let isDragging = false;
  let currentHourAngle = 270;
  let currentMinuteAngle = 90;
  let targetHour = 0;
  let targetMinute = 0;
  let correct = 0;
  let wrong = 0;

  function updateStats() {
    correctEl.textContent = correct;
    wrongEl.textContent = wrong;
    const total = correct + wrong;
    progressEl.textContent = total === 0 ? "0%" : Math.round((correct / total) * 100) + "%";
  }

  const setRotation = (el, angle) => {
    el.style.transform = `rotate(${angle}deg)`;
  };

  const roundToQuarter = (angle) => {
    const quarters = [0, 90, 180, 270, 360];
    return quarters.reduce((a, b) =>
      Math.abs(b - angle) < Math.abs(a - angle) ? b : a
    );
  };

  const roundToHour = (angle) => Math.round(angle / 30) * 30;

  function generateTime() {
    const h = Math.floor(Math.random() * 24);
    const m = [0, 15, 30, 45][Math.floor(Math.random() * 4)];
    targetHour = h;
    targetMinute = m;
    targetDisplay.textContent = `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
    feedback.innerHTML = '';
    newBtn.disabled = true;
    newBtn.classList.add("new");
    currentHourAngle = 270;
    currentMinuteAngle = 90;
    setRotation(hourHand, currentHourAngle);
    setRotation(minuteHand, currentMinuteAngle);
  }

  function checkAnswer() {
    const hour = Math.round((currentHourAngle % 360) / 30) % 12;
    const minute = Math.round((currentMinuteAngle % 360) / 6) % 60;
    const guessHour = hour + (targetHour >= 12 ? 12 : 0);
    const guessMin = Math.round(minute / 15) * 15 % 60;

    if (guessHour === targetHour && guessMin === targetMinute) {
      feedback.innerHTML = `<div class="success">‚úÖ –í–µ—Ä–Ω–æ! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!</div>`;
      correct++;
      newBtn.disabled = false;
      newBtn.classList.remove("new");
    } else {
      feedback.innerHTML = `<div class="error">‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë!</div>`;
      wrong++;
    }
    updateStats();
  }

  function setupDragging(hand, isHour) {
    const moveDrag = (x, y) => {
      const rect = document.getElementById("clock").getBoundingClientRect();
      const cx = rect.left + rect.width / 2;
      const cy = rect.top + rect.height / 2;
      const dx = x - cx;
      const dy = y - cy;
      let angle = Math.atan2(dx, -dy) * 180 / Math.PI;
      if (angle < 0) angle += 360;

      if (dragging?.isHour) {
        currentHourAngle = angle;
        setRotation(hourHand, angle);
      } else if (dragging?.isMinute) {
        currentMinuteAngle = angle;
        setRotation(minuteHand, angle);
      }
    };

    const releaseSnap = () => {
      if (dragging) {
        if (dragging.isHour) {
          const snap = roundToHour(currentHourAngle);
          currentHourAngle = snap;
          setRotation(hourHand, snap);
        } else {
          const snap = roundToQuarter(currentMinuteAngle);
          currentMinuteAngle = snap;
          setRotation(minuteHand, snap);
        }
        dragging = null;
        isDragging = false;
      }
    };

    hand.addEventListener("mousedown", () => {
      dragging = isHour ? { isHour: true } : { isMinute: true };
    });

    hand.addEventListener("touchstart", e => {
      dragging = isHour ? { isHour: true } : { isMinute: true };
      isDragging = true;
    }, { passive: false });

    document.addEventListener("mousemove", e => {
      if (dragging) moveDrag(e.clientX, e.clientY);
    });
    document.addEventListener("touchmove", e => {
      if (dragging) {
        moveDrag(e.touches[0].clientX, e.touches[0].clientY);
        e.preventDefault(); // –±–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª
      }
    }, { passive: false });

    document.addEventListener("mouseup", releaseSnap);
    document.addEventListener("touchend", releaseSnap);
  }

  checkBtn.addEventListener("click", checkAnswer);
  newBtn.addEventListener("click", generateTime);

  function startLevel(num) {
    document.getElementById("gameArea").style.display = "block";
    generateTime();
  }

  document.addEventListener("DOMContentLoaded", () => {
    // –¶–∏—Ñ—Ä—ã –Ω–∞ —Ü–∏—Ñ–µ—Ä–±–ª–∞—Ç
    const clock = document.getElementById("clock");
    const radius = 125;
    const centerX = 125, centerY = 125;
    for (let i = 1; i <= 12; i++) {
      const angle = (i - 3) * 30 * Math.PI / 180;
      const x = centerX + radius * 0.85 * Math.cos(angle);
      const y = centerY + radius * 0.85 * Math.sin(angle);
      const num = document.createElement("div");
      num.className = "number";
      num.textContent = i;
      num.style.left = `${x}px`;
      num.style.top = `${y}px`;
      clock.appendChild(num);
    }

    setupDragging(hourHand, true);
    setupDragging(minuteHand, false);

    // –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ —É—Ä–æ–≤–Ω—è
    startLevel(1);
  });
</script>
</body>
</html>