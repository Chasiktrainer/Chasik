<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Тренажёр «Часики»</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: "Segoe UI", sans-serif;
      background: #f4f7fc; color: #2c3e50;
      overflow-x: hidden;
    }
    h1 { text-align: center; font-size: 2rem; margin-top: 16px; }
    .level-buttons, .stats, .controls, .input-section {
      display: flex; justify-content: center; gap: 12px; flex-wrap: wrap;
      margin-top: 20px;
    }
    .level-buttons button {
      padding: 12px 20px;
      background: #3498db; border: none; border-radius: 8px;
      color: white; font-weight: bold; cursor: pointer;
    }
    .stats {
      flex-direction: column;
      align-items: center;
      margin-top: 10px;
    }
    .clock {
      width: 240px; height: 240px;
      border: 4px solid #3498db; border-radius: 50%;
      margin: 20px auto; position: relative;
      background: radial-gradient(#fff, #ecf0f3);
    }
    .hand {
      position: absolute;
      left: 50%; bottom: 50%;
      transform-origin: bottom center;
      border-radius: 50px;
    }
    .hand.hour { width: 6px; height: 60px; background: #e74c3c; }
    .hand.minute { width: 4px; height: 90px; background: #2980b9; }

    .number {
      position: absolute;
      width: 24px; height: 24px;
      text-align: center; font-weight: bold;
      font-size: 1rem;
    }

    .result {
      text-align: center;
      font-weight: bold;
      margin-top: 10px;
    }

    input[type="text"] {
      padding: 10px; font-size: 1rem;
      border-radius: 6px; border: 1px solid #ccc;
      min-width: 100px;
      text-align: center;
    }

    .progress {
      margin: 10px auto;
      height: 12px;
      background: #ddd;
      border-radius: 8px;
      max-width: 300px;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background: #27ae60;
      transition: width 0.3s ease-in-out;
    }

    .back-btn {
      margin: 40px auto 20px;
      text-align: center;
    }
    .back-btn a {
      background: #3498db;
      color: white;
      padding: 12px 20px;
      text-decoration: none;
      border-radius: 8px;
      display: inline-block;
      font-weight: bold;
    }
  </style>
</head>
<body>

<h1>Тренажёр «Часики»</h1>

<div class="level-buttons">
  <button onclick="startLevel(1)">Уровень 1</button>
  <button onclick="startLevel(2)">Уровень 2</button>
  <button onclick="startLevel(3)">Уровень 3</button>
</div>

<div class="stats">
  <div id="score">Правильно: 0 — Неправильно: 0</div>
  <div id="percent">Прогресс: 0%</div>
  <div class="progress"><div class="progress-bar" id="bar"></div></div>
</div>

<div class="clock" id="clock">
  <div class="hand hour" id="hourHand"></div>
  <div class="hand minute" id="minuteHand"></div>
</div>

<div class="controls" id="level2Controls" style="display:none;">
  <p>Впишите, который сейчас час:</p>
  <input id="answer" type="text" placeholder="ЧЧ:ММ" />
</div>

<div class="controls">
  <div id="currentTime">Установите время: <strong id="targetTime">--:--</strong></div>
</div>

<div class="controls">
  <button onclick="checkAnswer()" id="checkBtn">Проверить</button>
  <button onclick="newTime()" id="nextBtn" disabled>Новое время</button>
</div>

<div class="result" id="feedback"></div>

<div class="back-btn">
  <a href="index.html">← Вернуться к теории</a>
</div>

<script>
  let correct = 0, wrong = 0, level = 1;
  let hour = 12, minute = 0;
  let dragging = null;

  const hourHand = document.getElementById('hourHand');
  const minuteHand = document.getElementById('minuteHand');
  const clock = document.getElementById('clock');
  const feedback = document.getElementById('feedback');
  const targetTime = document.getElementById('targetTime');

  function updateStats() {
    const percent = correct + wrong > 0 ? Math.round(correct / (correct + wrong) * 100) : 0;
    document.getElementById('score').textContent = `Правильно: ${correct} — Неправильно: ${wrong}`;
    document.getElementById('percent').textContent = `Прогресс: ${percent}%`;
    document.getElementById('bar').style.width = `${percent}%`;
  }

  function setClock(h, m) {
    const hrDeg = (h % 12 + m / 60) * 30;
    const minDeg = m * 6;
    hourHand.style.transform = `rotate(${hrDeg}deg)`;
    minuteHand.style.transform = `rotate(${minDeg}deg)`;
  }

  function newTime() {
    if (level === 1 || level === 3) {
      hour = Math.floor(Math.random() * 24);
      const steps = level === 1 ? [0,15,30,45] : [0,5,10,15,20,25,30,35,40,45,50,55];
      minute = steps[Math.floor(Math.random() * steps.length)];
      setClock(0, 0);
    } else if (level === 2) {
      hour = Math.floor(Math.random() * 24);
      minute = [0,15,30,45][Math.floor(Math.random() * 4)];
      setClock(hour, minute);
    }
    targetTime.textContent = `${String(hour).padStart(2,'0')}:${String(minute).padStart(2,'0')}`;
    document.getElementById('nextBtn').disabled = true;
    feedback.textContent = '';
    document.getElementById('answer').value = '';
  }

  function checkAnswer() {
    if (level === 2) {
      const userTime = document.getElementById('answer').value.trim();
      const correctTime = `${String(hour).padStart(2,'0')}:${String(minute).padStart(2,'0')}`;
      if (userTime === correctTime) {
        correct++;
        feedback.textContent = '✅ Верно!';
      } else {
        wrong++;
        feedback.textContent = '❌ Неправильно';
      }
      document.getElementById('nextBtn').disabled = false;
    } else {
      const hr = Math.round(currentRotation(hourHand) / 30) % 12;
      const min = Math.round(currentRotation(minuteHand) / 6) % 60;
      const hr24 = (hr === 0) ? 12 : hr;
      const isCorrect = hr24 === (hour % 12 || 12) && min === minute;
      if (isCorrect) {
        correct++;
        feedback.textContent = '✅ Верно!';
        setTimeout(() => newTime(), 1000);
      } else {
        wrong++;
        feedback.textContent = '❌ Неправильно';
      }
    }
    updateStats();
  }

  function startLevel(lv) {
    level = lv;
    document.getElementById('level2Controls').style.display = lv === 2 ? 'flex' : 'none';
    newTime();
  }

  function currentRotation(el) {
    const tr = window.getComputedStyle(el).transform;
    if (tr === 'none') return 0;
    const [a,b] = tr.match(/matrix.*\((.+)\)/)[1].split(',').map(parseFloat);
    return Math.round(Math.atan2(b, a) * (180 / Math.PI));
  }

  // Автозапуск первого уровня
  window.addEventListener('DOMContentLoaded', () => {
    startLevel(1);
  });
</script>

</body>
</html>