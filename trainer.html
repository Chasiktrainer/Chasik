<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Тренажёр "Часики"</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      padding: 0;
      background: #f3f7fa;
      color: #222;
      text-align: center;
    }
    h1 {
      margin: 20px 0;
      font-size: 26px;
    }
    .stats {
      background: white;
      margin: 10px auto;
      padding: 10px;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      font-weight: bold;
      color: #0a3571;
    }
    .buttons {
      margin: 20px 0;
    }
    button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }
    .active {
      background-color: #333;
      color: white;
    }
    .clock-container {
      margin: 20px auto;
      width: 300px;
      height: 300px;
      position: relative;
      border: 6px solid #2d91d2;
      border-radius: 50%;
    }
    .number {
      position: absolute;
      transform: translate(-50%, -50%);
      font-size: 18px;
    }
    .hand {
      position: absolute;
      bottom: 50%;
      left: 50%;
      transform-origin: bottom center;
      border-radius: 4px;
    }
    .hour {
      width: 4px;
      height: 70px;
      background: red;
      z-index: 2;
    }
    .minute {
      width: 3px;
      height: 100px;
      background: blue;
      z-index: 1;
    }
    .center-dot {
      width: 12px;
      height: 12px;
      background: black;
      border-radius: 50%;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      z-index: 5;
    }
    .input-time {
      margin: 15px;
      font-size: 20px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #aaa;
      width: 120px;
      text-align: center;
    }
    .progress {
      width: 80%;
      max-width: 400px;
      margin: 10px auto;
      height: 10px;
      background: #e0e0e0;
      border-radius: 5px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background: #2d91d2;
      width: 0%;
    }
    .task {
      font-size: 20px;
      margin: 15px 0;
    }
    .back-button {
      margin: 20px 0;
      text-decoration: none;
      color: white;
      background: #2d91d2;
      padding: 10px 20px;
      border-radius: 8px;
      display: inline-block;
    }
  </style>
</head>
<body>

<h1>Тренажёр "Часики"</h1>

<div class="stats" id="topStats">
  <div>Правильных: <span id="correctCount">0</span></div>
  <div>Всего попыток: <span id="totalCount">0</span></div>
  <div>Неправильных: <span id="wrongCount">0</span></div>
  <div class="progress"><div class="progress-bar" id="progressBar"></div></div>
</div>

<div class="buttons">
  <button id="level1" class="active">Уровень 1</button>
  <button id="level2">Уровень 2</button>
  <button id="level3">Уровень 3</button>
</div>

<div class="clock-container" id="clock">
  <div class="hand hour" id="hourHand"></div>
  <div class="hand minute" id="minuteHand"></div>
  <div class="center-dot"></div>
  <!-- Цифры -->
  <script>
    for (let i = 1; i <= 12; i++) {
      const angle = (i * 30) * (Math.PI / 180);
      const x = 150 + 120 * Math.sin(angle);
      const y = 150 - 120 * Math.cos(angle);
      document.write(`<div class="number" style="left:${x}px;top:${y}px">${i}</div>`);
    }
  </script>
</div>

<div class="task" id="taskText">Установите время: <strong id="setTime">--:--</strong></div>
<input type="text" id="userInput" class="input-time" placeholder="ЧЧ:ММ" />

<div class="buttons">
  <button id="checkBtn">Проверить</button>
  <button id="nextBtn" disabled>Новое задание</button>
</div>

<a href="index.html" class="back-button">← Вернуться к теории</a>

<script>
  const hourHand = document.getElementById('hourHand');
  const minuteHand = document.getElementById('minuteHand');
  const setTimeText = document.getElementById('setTime');
  const input = document.getElementById('userInput');
  const checkBtn = document.getElementById('checkBtn');
  const nextBtn = document.getElementById('nextBtn');
  const correctCount = document.getElementById('correctCount');
  const totalCount = document.getElementById('totalCount');
  const wrongCount = document.getElementById('wrongCount');
  const progressBar = document.getElementById('progressBar');
  const levelButtons = {
    1: document.getElementById('level1'),
    2: document.getElementById('level2'),
    3: document.getElementById('level3')
  };

  let correct = 0, total = 0, wrong = 0, currentTime = '', currentLevel = 1;

  function generateTime() {
    let hour = Math.floor(Math.random() * 12);
    let minute = 0;

    if (currentLevel === 1) {
      const quarters = [0, 15, 30, 45];
      minute = quarters[Math.floor(Math.random() * 4)];
    } else {
      minute = Math.floor(Math.random() * 12) * 5;
    }

    const displayHour = hour < 10 ? '0' + hour : hour;
    const displayMinute = minute < 10 ? '0' + minute : minute;
    currentTime = `${displayHour}:${displayMinute}`;

    // Update hands
    hourHand.style.transform = `rotate(${(hour % 12 + minute / 60) * 30}deg)`;
    minuteHand.style.transform = `rotate(${minute * 6}deg)`;

    setTimeText.textContent = currentTime;
    input.value = '';
    nextBtn.disabled = true;
  }

  function updateStats() {
    correctCount.textContent = correct;
    totalCount.textContent = total;
    wrongCount.textContent = wrong;
    const percent = total > 0 ? (correct / total) * 100 : 0;
    progressBar.style.width = percent + '%';
  }

  checkBtn.addEventListener('click', () => {
    const userTime = input.value.trim();
    total++;
    let accepted = [currentTime];

    // Accept both 12h and 24h formats
    const parts = currentTime.split(':');
    const altHour = (parseInt(parts[0], 10) + 12) % 24;
    const altTime = (altHour < 10 ? '0' : '') + altHour + ':' + parts[1];
    accepted.push(altTime);

    if (accepted.includes(userTime)) {
      correct++;
    } else {
      wrong++;
    }
    updateStats();
    nextBtn.disabled = false;
  });

  nextBtn.addEventListener('click', generateTime);

  // Level selection
  Object.entries(levelButtons).forEach(([lvl, btn]) => {
    btn.addEventListener('click', () => {
      currentLevel = parseInt(lvl);
      Object.values(levelButtons).forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      generateTime();
    });
  });

  // Init
  generateTime();
</script>
</body>
</html>