<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Тренажёр "Часики"</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
      background: #f1f8ff;
    }

    h1 {
      margin-top: 20px;
    }

    .level-buttons {
      margin: 10px;
    }

    .level-buttons button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 16px;
    }

    .stats {
      margin: 15px auto;
      padding: 10px;
      width: 90%;
      max-width: 400px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    .progress-bar {
      width: 100%;
      height: 10px;
      background-color: #ddd;
      border-radius: 5px;
      overflow: hidden;
      margin-top: 10px;
    }

    #progressFill {
      height: 100%;
      background-color: #4CAF50;
      width: 0%;
    }

    #clock {
      background-color: white;
      border-radius: 50%;
      border: 6px solid #3399ff;
      margin: 20px auto;
      display: block;
    }

    #center-dot {
      position: absolute;
      width: 14px;
      height: 14px;
      background-color: black;
      border-radius: 50%;
      top: 390px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 5;
    }

    #timeInput {
      font-size: 18px;
      padding: 8px;
      margin: 10px auto;
      display: block;
      text-align: center;
      width: 120px;
    }

    .buttons {
      margin: 10px;
    }

    .buttons button {
      font-size: 18px;
      padding: 10px 20px;
      margin: 5px;
    }

    #resultMessage {
      font-weight: bold;
      font-size: 18px;
      margin-top: 10px;
    }

  </style>
</head>
<body>
  <h1>Тренажёр «Часики»</h1>

  <div class="stats">
    <p><strong>Правильных:</strong> <span id="correctCount">0</span></p>
    <p><strong>Всего попыток:</strong> <span id="totalCount">0</span></p>
    <p><strong>Неправильных:</strong> <span id="wrongCount">0</span></p>
    <div class="progress-bar">
      <div id="progressFill"></div>
    </div>
  </div>

  <div class="level-buttons">
    <button onclick="setLevel(1)" id="level1Btn">Уровень 1</button>
    <button onclick="setLevel(2)" id="level2Btn">Уровень 2</button>
    <button onclick="setLevel(3)" id="level3Btn">Уровень 3</button>
  </div>

  <canvas id="clock" width="300" height="300"></canvas>
  <div id="center-dot"></div>

  <div id="timeTask" style="font-size: 18px; margin-top: 10px;"></div>

  <div id="level2InputBlock" style="display: none;">
    <label for="timeInput">Введите время, изображенное на часах:</label>
    <input type="text" id="timeInput" placeholder="ЧЧ:ММ">
  </div>

  <div class="buttons">
    <button onclick="checkAnswer()">Проверить</button>
    <button onclick="generateTime()">Новое задание</button>
  </div>

  <div id="resultMessage"></div>

  <script>
    const canvas = document.getElementById("clock");
    const ctx = canvas.getContext("2d");
    const radius = canvas.height / 2;
    ctx.translate(radius, radius);

    let correct = 0;
    let wrong = 0;
    let total = 0;
    let currentLevel = 1;
    let hour = 0;
    let minute = 0;

    function setLevel(level) {
      currentLevel = level;
      document.getElementById("level2InputBlock").style.display = level === 2 ? "block" : "none";
      generateTime();
    }

    function drawClock(h, m) {
      ctx.clearRect(-radius, -radius, canvas.width, canvas.height);
      ctx.beginPath();
      ctx.arc(0, 0, radius * 0.95, 0, 2 * Math.PI);
      ctx.strokeStyle = "#3399ff";
      ctx.lineWidth = 6;
      ctx.stroke();

      for (let num = 1; num <= 12; num++) {
        const ang = num * Math.PI / 6;
        ctx.font = radius * 0.15 + "px sans-serif";
        ctx.textBaseline = "middle";
        ctx.textAlign = "center";
        ctx.fillText(num, radius * 0.75 * Math.sin(ang), -radius * 0.75 * Math.cos(ang));
      }

      let hourAngle = (h % 12 + m / 60) * Math.PI / 6;
      let minuteAngle = (m) * Math.PI / 30;

      // часовая стрелка
      ctx.beginPath();
      ctx.strokeStyle = "red";
      ctx.lineWidth = 5;
      ctx.moveTo(0, 0);
      ctx.lineTo(radius * 0.5 * Math.sin(hourAngle), -radius * 0.5 * Math.cos(hourAngle));
      ctx.stroke();

      // минутная стрелка
      ctx.beginPath();
      ctx.strokeStyle = "blue";
      ctx.lineWidth = 3;
      ctx.moveTo(0, 0);
      ctx.lineTo(radius * 0.8 * Math.sin(minuteAngle), -radius * 0.8 * Math.cos(minuteAngle));
      ctx.stroke();
    }

    function generateTime() {
      let minutesStep = currentLevel === 1 ? 15 : 5;
      hour = Math.floor(Math.random() * 24);
      minute = Math.floor(Math.random() * (60 / minutesStep)) * minutesStep;

      if (currentLevel === 2) {
        document.getElementById("timeTask").innerText = "";
        document.getElementById("timeInput").value = "";
      } else {
        document.getElementById("timeTask").innerHTML = `<strong>Установите время:</strong> ${pad(hour)}:${pad(minute)}`;
      }

      drawClock(hour, minute);
      document.getElementById("resultMessage").innerText = "";
    }

    function pad(n) {
      return n < 10 ? "0" + n : n;
    }

    function checkAnswer() {
      if (currentLevel === 2) {
        const userInput = document.getElementById("timeInput").value.trim();
        if (!/^\d{1,2}:\d{2}$/.test(userInput)) return;

        const [h, m] = userInput.split(":").map(Number);
        const validH = (h === hour || h === (hour + 12) % 24) && m === minute;
        updateStats(validH);
      } else {
        // в реальном проекте сравниваем состояние стрелок
        alert("Проверка только во 2 уровне (в демо)");
      }
    }

    function updateStats(isCorrect) {
      total++;
      if (isCorrect) {
        correct++;
        document.getElementById("resultMessage").innerText = "Верно!";
      } else {
        wrong++;
        document.getElementById("resultMessage").innerText = `Неправильно! Верное: ${pad(hour)}:${pad(minute)}`;
      }

      document.getElementById("correctCount").innerText = correct;
      document.getElementById("wrongCount").innerText = wrong;
      document.getElementById("totalCount").innerText = total;

      const progress = total === 0 ? 0 : Math.round((correct / total) * 100);
      document.getElementById("progressFill").style.width = `${progress}%`;
    }

    // Инициализация
    setLevel(1);
  </script>
</body>
</html>